

<html>
<head>
  <title>terminal Control</title>
  <link rel="stylesheet" href="xterm/css/xterm.css" />
  <script src="xterm/lib/xterm.js"></script>

</head>

<body>


    <div id="terminal"></div>



    <script src="/socket.io/socket.io.js"></script>
    <script>
        var socket = io();
        var term = new Terminal({
			cols: 120,
			rows: 60,
			useStyle: true,
			screenKeys: true
		});

      var curr_line = "";
      var entries = [];
      term.open(document.getElementById("terminal"));
      term.write("web shell $ ");

      term.prompt = () => {
        if (curr_line) {
          let data = { method: "command", command: curr_line };
          socket.emit("command", JSON.stringify(data));
        }
      };
      term.prompt();

      // Receive data from socket
      socket.on("result", function(msg) {
        term.write("\r\n" + JSON.parse(msg.data).data);
        curr_line = "";
        })


      term.onData("key", function(key, ev) {
        //Enter
        if (ev.keyCode === 13) {
          if (curr_line) {
            entries.push(curr_line);
            term.write("\r\n");
            term.prompt();
          }
        } else if (ev.keyCode === 8) {
          // Backspace
          if (curr_line) {
            curr_line = curr_line.slice(0, curr_line.length - 1);
            term.write("\b \b");
          }
        } else {
          curr_line += key;
          term.write(key);
        }
      });

      // paste value
      term.onData("paste", function(data) {
        curr_line += data;
        term.write(data);
      });
    </script>




</body>
</html>

